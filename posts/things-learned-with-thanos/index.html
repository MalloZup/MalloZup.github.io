<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Dario Maiocchi">
    <meta name="description" content="Dario Maiocchi&#39;s personal website">
    <meta name="keywords" content="foss, lisp, linux, clojure and other stuff around software">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Things and projects learned within Thanos opensource project"/>
<meta name="twitter:description" content="A experience about thanos project"/>

    <meta property="og:title" content="Things and projects learned within Thanos opensource project" />
<meta property="og:description" content="A experience about thanos project" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mallozup.github.io/posts/things-learned-with-thanos/" />
<meta property="article:published_time" content="2020-12-22T12:26:17+01:00" />
<meta property="article:modified_time" content="2020-12-22T12:26:17+01:00" />


    
      <base href="https://mallozup.github.io/posts/things-learned-with-thanos/">
    
    <title>
  Things and projects learned within Thanos opensource project · (def Think humble, think free) --&gt; 
</title>

    
      <link rel="canonical" href="https://mallozup.github.io/posts/things-learned-with-thanos/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://mallozup.github.io/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://mallozup.github.io/css/custom.css" />
    

    
    
    <link rel="icon" type="image/png" href="https://mallozup.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://mallozup.github.io/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.56.3" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://mallozup.github.io/">
      (def Think humble, think free) --&gt; 
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://mallozup.github.io/posts/">Blog</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Things and projects learned within Thanos opensource project</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2020-12-22T12:26:17&#43;01:00'>
                December 22, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              3 minutes read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://mallozup.github.io/tags/monitoring/">monitoring</a>
      <span class="separator">•</span>
    <a href="https://mallozup.github.io/tags/observability/">observability</a></div>

        </div>
      </header>

      <div>
        

<h1 id="things-learned-with-thanos-opensource-proejct">Things learned with Thanos opensource proejct</h1>

<p>Recently I started working and learning thanos concepts just for fun and as <strong>opensource individual</strong> (during my free time).</p>

<p>I wasnt to summarize things I have learned:</p>

<ul>
<li><p>1) Prometheus <code>mixins</code> and jsonnet concepts</p></li>

<li><p>2) Grpc protocol and middlewares</p></li>

<li><p>3) Rate limiting algorithm</p></li>

<li><p>4) Prometheus internals</p></li>

<li><p>5) CNCF Observability and other groups</p></li>

<li><p>6) Misc</p></li>
</ul>

<h2 id="1-prometheus-mixing">1) Prometheus mixing</h2>

<p>From upstream, A mixin is a set of Grafana dashboards and Prometheus rules and alerts, packaged together in a reuseable and extensible bundle.</p>

<p>See for more details: <a href="https://monitoring.mixins.dev">https://monitoring.mixins.dev</a></p>

<p>Thanos mixins are located here:  <a href="https://github.com/thanos-io/thanos/tree/master/mixin">https://github.com/thanos-io/thanos/tree/master/mixin</a></p>

<p>The following part is based on my experience:</p>

<p>Personally I was aware of the paper of mixing but I didn&rsquo;t have seen an adoption till 2020 of the concept which was made written in 2018.
I personally see the problem which is trying to adress but from my perspective, mixins could also add complexity to a simple configuration or files , which mostly what dashboards rules are.
Anyways, in Thanos mixins are well maintained and the UX is easy enough to add rules via libsonet, allthough setting up mixins to single projects ( outside thanos etc) is more complexity then just using and saving the &ldquo;plain&rdquo; config file.</p>

<p>I do see mixins as really nice attempt to solve some problem which is known, but maybe there are other things which people can use . ( Configuration management software, RPM or other packaging etc)</p>

<h2 id="2-grpc-protocol-and-middlewares">2) Grpc protocol and middlewares</h2>

<p>I didn&rsquo;t used Grpc servers. ( <a href="https://grpc.io/">https://grpc.io/</a>)</p>

<p>I&rsquo;m positive surprised by the standard of middleware and easyness of initialisation you can add on top of Grpc (middlewares) <a href="https://github.com/grpc-ecosystem/go-grpc-middleware">https://github.com/grpc-ecosystem/go-grpc-middleware</a>.</p>

<h1 id="3-rate-limit-implementations-and-algorithms">3) Rate-Limit implementations and algorithms.</h1>

<p>I took initiative on solving an issue on thanos with rate-limiting (is still pending).</p>

<p>Grpc has natively no mechanims to limit rates.</p>

<p>During the journey, I researched various rate-limiting algorithms and mechanism.</p>

<p>Some useful readings I found in the web regarding this topic:</p>

<p>( <a href="https://jbrandhorst.com/post/go-semaphore/">https://jbrandhorst.com/post/go-semaphore/</a>) this is mostly implemented also by the prometheus <code>gate</code> construct used by thanos for limiting the queries
<a href="https://github.com/thanos-io/thanos/blob/1fff9a7157d1f3b7d5e0ce36f999b10bb3ae7ec4/pkg/gate/gate.go#L31">https://github.com/thanos-io/thanos/blob/1fff9a7157d1f3b7d5e0ce36f999b10bb3ae7ec4/pkg/gate/gate.go#L31</a></p>

<h1 id="4-prometheus-internals-and-above">4) Prometheus Internals and above:</h1>

<p>Thanos is embeded really closely to prometheus and people who maintains thanos use to contribute/maintain prometheus. ( golang allow to import library directly)
So at the end when you end up learning thanos you learn always a bit more of prometheus internals.
Also some curious side, you might endup to learn a bit cortex, since thanos and cortex share some part of code like query-frontend.</p>

<h1 id="5-cncf-groups">5) CNCF groups:</h1>

<p>I discovered also there is a calender and meeting group avail here:</p>

<p><a href="https://www.cncf.io/calendar/">https://www.cncf.io/calendar/</a></p>

<p>Groups which I will follow-up as individual opensource contributor next year  will be mostly #thanos and #observability group.</p>

<h1 id="6-misc">6) Misc:</h1>

<p>Other things I appreciated in thanos:</p>

<ul>
<li><p><a href="https://katacoda.com/thanos/courses/thanos/1-globalview">https://katacoda.com/thanos/courses/thanos/1-globalview</a> is a &ldquo;live&rdquo; experience for using thanos and learning it. Really useful</p></li>

<li><p>RFC or kind of architectural Decision log embedded in github repo: <a href="https://github.com/thanos-io/thanos/tree/master/docs/proposals">https://github.com/thanos-io/thanos/tree/master/docs/proposals</a></p></li>

<li><p>CLI: thanos is using <a href="https://github.com/alecthomas/kingpin">https://github.com/alecthomas/kingpin</a> for building a CLI in go  (unlike other CNCF clis which user viper etc library)</p></li>
</ul>

      </div>

      <footer>
        


        
        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <p>free software, free thoughts</p>
    
     © 2020
    
       · 
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
